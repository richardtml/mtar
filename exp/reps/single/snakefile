# Single-task experiments

include: "exp/conv.smk"
include: "exp/seminar.smk"
include: "exp/single.smk"


from itertools import product


epochs = 500
dss = ('hmdb51', 'ucf101')
splits = (1,)
models = ('Conv2D', 'Conv2D1D', 'FullConv', 'Rec')
configs = (splits, models)


rule ucf101:
  run:
    for split, model in product(*configs):
      shell(
        "python train.py"
        f" --ds ucf101"
        f" --split {split}"
        f" --model {model}"
        f" --epochs {epochs}"
      )

rule hmdb51:
  run:
    for split, model in product(*configs):
      shell(
        "python train.py"
        f" --ds hmdb51"
        f" --split {split}"
        f" --model {model}"
        f" --epochs {epochs}"
      )

rule seminar:
  """Seminar 22/10/19"""
  run:
    epochs = 500
    dss = ('hmdb51', 'ucf101')
    models = ('Conv2D', 'Conv2D1D', 'FullConv')
    filters_sizes = (128, 256)
    dropout = 0
    configs = (dss, models, filters_sizes)
    for ds, model, conv2d_filters in product(*configs):
      shell(
        "python train.py"
        f" --ds {ds}"
        f" --model {model}"
        f" --conv2d_filters {conv2d_filters}"
        f" --dropout 0"
        f" --epochs {epochs}"
      )
    for ds, model, conv2d_filters in product(*configs):
      shell(
        "python train.py"
        f" --ds {ds}"
        f" --model {model}"
        f" --conv2d_filters {conv2d_filters}"
        f" --dropout 0.5"
        f" --lr 1e-2"
        f" --epochs {epochs}"
      )
    rec_sizes = (128, 256)
    configs = (dss, rec_sizes)
    for ds, rec_size in product(*configs):
      shell(
        "python train.py"
        f" --ds {ds}"
        f" --model Rec"
        f" --rec_size {rec_size}"
        f" --epochs {epochs}"
      )


# rule conv:
#   """Test number of params in conv2d and conv1d layers"""
#   run:
#     epochs = 1
#     models = ('Conv2D', 'Conv2D1D', 'FullConv')
#     conv_filters = (96, 128, 160)
#     configs = (models, conv_filters, conv_filters)
#     for model, conv2d_filters, conv1d_filters in product(*configs):
#       shell(
#         "python train.py"
#         f" --exp_name {rule.name}"
#         f" --ds ucf101"
#         f" --model {model}"
#         f" --conv2d_filters {conv2d_filters}"
#         f" --conv1d_filters {conv1d_filters}"
#         f" --dropout 0.5"
#         f" --epochs {epochs}"
#       )
